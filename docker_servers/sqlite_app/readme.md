# FastAPI + SQLite Docker Application

## Описание

Этот проект представляет собой серверное приложение на FastAPI, работающее внутри Docker-контейнера. Сервер управляет регистрацией пользователей и аутентификацией с использованием базы данных SQLite, которая хранится как Docker volume для обеспечения сохранности данных при перезапуске контейнера.

---

## Структура проекта

- **Dockerfile**: Содержит инструкции для сборки образа Docker с установленным Python, FastAPI и зависимостями.
- **main.py**: Основной код сервера FastAPI, который предоставляет API для регистрации пользователей, аутентификации и запроса идентификаторов.
- **sql_service.py**: Модуль для взаимодействия с базой данных SQLite, включая создание таблиц, добавление пользователей и получение данных.
- **requirements.txt**: Список зависимостей Python, необходимых для работы приложения.
- **tests/tests.sh**: Скрипт для автоматического тестирования основных функций API.

---

## Запуск приложения

### Шаг 1: Сборка Docker-образа

Выполните следующую команду в терминале:

```bash
docker build -t my_fastapi_app .
```

### Шаг 2: Запуск Docker-контейнера

**Обязательно поменяйте папку монтирования docker Volumes**

Запустите контейнер с монтированием volume для хранения данных SQLite:

```bash
docker run -d -v /Users/alicee/Desktop/Work_Main/docker_test/docker_servers/db_sqlite:/app/data -p 8000:8000 --name my_fastapi_container my_fastapi_app
```

- **-v /Users/alicee/Desktop/Work_Main/docker_test/docker_servers/db_sqlite:/app/data**: Монтирует локальную директорию как volume для хранения данных SQLite.
- **-p 8000:8000**: Открывает порт 8000 для доступа к API.
- **--name my_fastapi_container**: Присваивает имя контейнеру.

---

## Описание API

### Регистрация пользователя

**URL**: `/register`
**Метод**: `POST`
**Описание**: Регистрирует нового пользователя.
**Тело запроса**:

```json
{
  "name": "John Doe",
  "email": "john@example.com",
  "login": "johndoe",
  "password": "hashed_password"
}
```

### Вход пользователя

**URL**: `/login`
**Метод**: `POST`
**Описание**: Аутентифицирует пользователя.
**Тело запроса**:

```json
{
  "login": "johndoe",
  "password": "hashed_password"
}
```

### Запрос идентификатора пользователя

**URL**: `/id_request`
**Метод**: `POST`
**Описание**: Получает идентификатор пользователя по логину.
**Тело запроса**:

```json
{
  "login": "johndoe"
}
```

---

## Требования

- Docker
- Python 3.9
- FastAPI
- SQLAlchemy

---

## Зависимости

Убедитесь, что все зависимости указаны в `requirements.txt`:

```
fastapi
uvicorn
sqlalchemy
bcrypt
```

---

## Примечания

- Данные пользователей (SQLite база данных) хранятся в директории `/app/data` в контейнере и монтируются на локальную директорию `/Users/alicee/Desktop/Work_Main/docker_test/docker_serveres/db_sqlite`.
- Для обеспечения безопасности пароли должны храниться в хэшированном виде. Рекомендуется использовать `bcrypt` для хэширования паролей перед сохранением.

### Описание тестов (tests/tests.sh)

**Обязательно поменяйте папку монтирования docker Volumes**

1. Скрипт собирает Docker-образ с помощью команды `docker build`.
2. Запускает Docker-контейнер в фоновом режиме (`-d`) и маппит порт `8000`.
3. Пауза в 5 секунд (`sleep 5`) нужна для того, чтобы дать время FastAPI-приложению полностью запуститься.
4. Использует `curl` для тестирования API:
   * Тестирует регистрацию нового пользователя.
   * Тестирует вход пользователя.
   * Тестирует запрос на получение ID пользователя.
5. После завершения тестов останавливает и удаляет контейнер.

Этот скрипт должен корректно работать с вашим приложением и проверять все описанные функции.
